(()=>{"use strict";var e={156:function(e,s,o){var t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0});const n=t(o(252)),r=t(o(163)),c=t(o(305)),a=t(o(130));t(o(818)).default.config();const i=(0,n.default)(),l=process.env.PORT||3e3;i.use(n.default.json({limit:"10mb",strict:!1})),i.use(c.default);const u=(0,r.default)();u.setApiVersion("2023-10"),u.setToken(String(process.env.MONDAY_KEY)),u.api("query { users { name } }").then((e=>console.log(JSON.stringify(e)))),new a.default.Connection({loginUrl:"https://login.salesforce.com"});const d=new a.default.OAuth2({loginUrl:"https://ringcentral13-dev-ed.develop.my.salesforce.com",clientId:process.env.SF_KEY,clientSecret:process.env.SECRET,redirectUri:"http://localhost:3000/token"});i.get("/api/accounts",(function(e,s){e.session.accessToken&&e.session.instanceUrl||s.redirect("/");let o=new a.default.Connection({oauth2:d,accessToken:e.session.accessToken,instanceUrl:e.session.instanceUrl}),t=[],n=o.query("SELECT id, name FROM account LIMIT 10").on("record",(function(e){t.push(e)})).on("end",(function(){console.log("total in database : "+n.totalSize),console.log("total fetched : "+n.totalFetched),s.json(t)})).on("error",(function(e){console.error(e)})).run({autoFetch:!0,maxFetch:4e3})})),i.use(n.default.static("./build")),i.get("/auth/login",(function(e,s){s.redirect(d.getAuthorizationUrl({scope:"api id web refresh_token"}))})),i.get("/token",(function(e,s){const o=new a.default.Connection({oauth2:d}),t=e.query.code;o.authorize(t,(function(s,t){if(s)return console.error("This error is in the auth callback: "+s);console.log("Access Token: "+o.accessToken),console.log("Instance URL: "+o.instanceUrl),console.log("refreshToken: "+o.refreshToken),console.log("User ID: "+t.id),console.log("Org ID: "+t.organizationId),e.session.accessToken=o.accessToken,e.session.instanceUrl=o.instanceUrl,e.session.refreshToken=o.refreshToken,encodeURIComponent("true")}))})),i.listen(l,(()=>{console.log(`⚡️[server]: Server started on ${l}`)}))},845:(e,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.health=void 0,s.health=(e,s)=>{s.status(200).json({message:"wm-api is up 🟢"})}},305:function(e,s,o){var t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0});const n=o(845),r=o(713),c=t(o(252)).default.Router();c.get("/health",n.health),c.get("/api/version",((e,s)=>{(0,r.sendSuccessResponse)({res:s,data:{release:process.env.RELEASE_NUMBER||.1,build:process.env.BUILD_NUMBER||.1,date:process.env.BUILD_DATE||(new Date).toISOString().replace("T"," ").slice(0,19)},message:null,statusCode:200})})),s.default=c},713:(e,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.sendSuccessResponse=s.delay=s.validateEmail=void 0,s.validateEmail=e=>String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),s.delay=e=>new Promise((s=>setTimeout(s,e))),s.sendSuccessResponse=({res:e,data:s={},message:o,statusCode:t,count:n,clearCookie:r=!1})=>{n&&(s.count=n);let c={data:s};return r&&e.clearCookie("accessToken"),e.status(t).json(c)}},818:e=>{e.exports=require("dotenv")},252:e=>{e.exports=require("express")},130:e=>{e.exports=require("jsforce")},163:e=>{e.exports=require("monday-sdk-js")}},s={};!function o(t){var n=s[t];if(void 0!==n)return n.exports;var r=s[t]={exports:{}};return e[t].call(r.exports,r,r.exports,o),r.exports}(156)})();
//# sourceMappingURL=index.js.map