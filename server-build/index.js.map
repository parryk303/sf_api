{"version":3,"file":"index.js","mappings":"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","sources":["webpack://sf-api/./src/index.ts","webpack://sf-api/./src/server/interfaces/health.ts","webpack://sf-api/./src/server/routes/index.ts","webpack://sf-api/./src/server/utils/utils.ts","webpack://sf-api/external commonjs \"dotenv\"","webpack://sf-api/external commonjs \"express\"","webpack://sf-api/external commonjs \"jsforce\"","webpack://sf-api/external commonjs \"monday-sdk-js\"","webpack://sf-api/webpack/bootstrap","webpack://sf-api/webpack/startup"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst express_1 = __importDefault(require(\"express\"));\nconst monday_sdk_js_1 = __importDefault(require(\"monday-sdk-js\"));\nconst routes_1 = __importDefault(require(\"./server/routes\"));\nconst jsforce_1 = __importDefault(require(\"jsforce\"));\nconst dotenv_1 = __importDefault(require(\"dotenv\"));\ndotenv_1.default.config();\nconst app = (0, express_1.default)();\nconst port = process.env.PORT || 3000;\napp.use(express_1.default.json({ limit: '10mb', strict: false }));\napp.use(routes_1.default);\n// Authenticate with Monday.com API\nconst monday = (0, monday_sdk_js_1.default)();\nmonday.setApiVersion('2023-10');\nmonday.setToken(String(process.env.MONDAY_KEY));\nmonday.api('query { users { name } }').then(res => console.log(JSON.stringify(res)));\n// Salesforce credentials\nconst username = `${process.env.USER}`;\nconst password = `${process.env.TOKEN}`;\n// Create a connection to Salesforce\nconst conn = new jsforce_1.default.Connection({ loginUrl: 'https://login.salesforce.com' });\n// Authenticate with Salesforce password\n// conn.login(username, password, function (err: any, userInfo: any) {\n//   if (err) {\n//     return console.error(err);\n//   }\n//   console.log('Logged in as: ' + userInfo.id, JSON.stringify(userInfo));\n//   // Query to fetch users\n//   const query = 'SELECT Id, Name, Email FROM User';\n//   // Execute the query\n//   conn.query(query, function (err: any, result: any) {\n//     if (err) {\n//       return console.error(err);\n//     }\n//     console.log('Total users: ' + result.totalSize);\n//     console.log('First user: ' + JSON.stringify(result.records[0]));\n//   });\n// });\n//jsForce connection\nconst oauth2 = new jsforce_1.default.OAuth2({\n    // you can change loginUrl to connect to sandbox or prerelease env.\n    loginUrl: 'https://ringcentral13-dev-ed.develop.my.salesforce.com',\n    //clientId and Secret will be provided when you create a new connected app in your SF developer account\n    clientId: process.env.SF_KEY,\n    clientSecret: process.env.SECRET,\n    redirectUri: 'http://localhost:3000/token'\n});\napp.get('/api/accounts', function (req, res) {\n    // if auth has not been set, redirect to index\n    if (!req.session.accessToken || !req.session.instanceUrl) {\n        res.redirect('/');\n    }\n    //SOQL query\n    let q = 'SELECT id, name FROM account LIMIT 10';\n    //instantiate connection\n    let conn = new jsforce_1.default.Connection({\n        oauth2: oauth2,\n        accessToken: req.session.accessToken,\n        instanceUrl: req.session.instanceUrl\n    });\n    //set records array\n    let records = [];\n    let query = conn.query(q)\n        .on('record', function (record) {\n        records.push(record);\n    })\n        .on('end', function () {\n        console.log('total in database : ' + query.totalSize);\n        console.log('total fetched : ' + query.totalFetched);\n        res.json(records);\n    })\n        .on('error', function (err) {\n        console.error(err);\n    })\n        .run({ autoFetch: true, maxFetch: 4000 });\n});\n// Serve static assets\napp.use(express_1.default.static('./build'));\n/**\n* Login endpoint\n*/\napp.get('/auth/login', function (req, res) {\n    // Redirect to Salesforce login/authorization page\n    res.redirect(oauth2.getAuthorizationUrl({ scope: 'api id web refresh_token' }));\n});\n/**\n* Login callback endpoint (only called by Force.com)\n*/\napp.get('/token', function (req, res) {\n    const conn = new jsforce_1.default.Connection({ oauth2: oauth2 });\n    const code = req.query.code;\n    conn.authorize(code, function (err, userInfo) {\n        if (err) {\n            return console.error('This error is in the auth callback: ' + err);\n        }\n        console.log('Access Token: ' + conn.accessToken);\n        console.log('Instance URL: ' + conn.instanceUrl);\n        console.log('refreshToken: ' + conn.refreshToken);\n        console.log('User ID: ' + userInfo.id);\n        console.log('Org ID: ' + userInfo.organizationId);\n        req.session.accessToken = conn.accessToken;\n        req.session.instanceUrl = conn.instanceUrl;\n        req.session.refreshToken = conn.refreshToken;\n        var string = encodeURIComponent('true');\n        // res.redirect('http://localhost:3000/?valid=' + string);\n    });\n});\napp.listen(port, () => {\n    console.log(`⚡️[server]: Server started on ${port}`);\n});\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.health = void 0;\nconst health = (req, res) => {\n    const responseMessage = 'wm-api is up 🟢';\n    res.status(200).json({ message: responseMessage });\n};\nexports.health = health;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst health_1 = require(\"../interfaces/health\");\nconst utils_1 = require(\"../utils/utils\");\nconst express_1 = __importDefault(require(\"express\"));\nconst router = express_1.default.Router();\nrouter.get('/health', health_1.health);\n// router.get('/oauth', oauth2);\nrouter.get('/api/version', (req, res) => {\n    (0, utils_1.sendSuccessResponse)({\n        res,\n        data: {\n            release: process.env.RELEASE_NUMBER || 0.1,\n            build: process.env.BUILD_NUMBER || 0.1,\n            date: process.env.BUILD_DATE || new Date().toISOString().replace('T', ' ').slice(0, 19),\n        },\n        message: null,\n        statusCode: 200,\n    });\n});\nexports.default = router;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.sendSuccessResponse = exports.delay = exports.validateEmail = void 0;\nconst validateEmail = (email) => {\n    return String(email)\n        .toLowerCase()\n        .match(/^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|.(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/);\n};\nexports.validateEmail = validateEmail;\nconst delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));\nexports.delay = delay;\nconst sendSuccessResponse = ({ res, data = {}, message, statusCode, count, clearCookie = false }) => {\n    if (count) {\n        data.count = count;\n    }\n    let response = {\n        data,\n    };\n    if (clearCookie) {\n        res.clearCookie('accessToken');\n    }\n    return res.status(statusCode).json(response);\n};\nexports.sendSuccessResponse = sendSuccessResponse;\n","module.exports = require(\"dotenv\");","module.exports = require(\"express\");","module.exports = require(\"jsforce\");","module.exports = require(\"monday-sdk-js\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(156);\n"],"names":["__importDefault","this","mod","__esModule","Object","defineProperty","exports","value","express_1","monday_sdk_js_1","routes_1","jsforce_1","default","config","app","port","process","env","PORT","use","json","limit","strict","monday","setApiVersion","setToken","String","MONDAY_KEY","api","then","res","console","log","JSON","stringify","Connection","loginUrl","oauth2","OAuth2","clientId","SF_KEY","clientSecret","SECRET","redirectUri","get","req","session","accessToken","instanceUrl","redirect","conn","records","query","on","record","push","totalSize","totalFetched","err","error","run","autoFetch","maxFetch","static","getAuthorizationUrl","scope","code","authorize","userInfo","refreshToken","id","organizationId","encodeURIComponent","listen","health","status","message","health_1","utils_1","router","Router","sendSuccessResponse","data","release","RELEASE_NUMBER","build","BUILD_NUMBER","date","BUILD_DATE","Date","toISOString","replace","slice","statusCode","delay","validateEmail","email","toLowerCase","match","ms","Promise","resolve","setTimeout","count","clearCookie","response","module","require","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","call"],"sourceRoot":""}